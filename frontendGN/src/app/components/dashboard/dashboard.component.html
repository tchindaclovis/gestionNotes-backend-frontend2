<div class="flex h-screen bg-slate-50">
  <!-- Sidebar -->
  <aside class="w-70 bg-white border-r border-indigo-100 flex flex-col shadow-lg shadow-blue-100">
    <!-- Logo/Header -->
    <div class="p-6 border-b border-indigo-100 bg-gradient-to-r from-blue-500 to-emerald-500">
      <h2 class="text-white text-2xl font-bold m-0 text-center">GestionNotes</h2>
    </div>

    <!-- Navigation Links -->
    <nav class="flex-1 py-5">
      <a class="block py-3 px-6 text-blue-700 no-underline font-medium transition-all border-l-4 border-transparent hover:bg-slate-100 hover:text-blue-500" [ngClass]="{'bg-blue-100 text-blue-800 border-l-blue-600 font-bold shadow-sm': activeSection === 'dashboard'}" (click)="setActiveSection('dashboard'); $event.preventDefault()">
        Tableau de bord
      </a>
      
      <a *ngIf="isStudent()" class="block py-3 px-6 text-blue-700 no-underline font-medium transition-all border-l-4 border-transparent hover:bg-slate-100 hover:text-blue-500" [ngClass]="{'bg-blue-100 text-blue-800 border-l-blue-600 font-bold shadow-sm': activeSection === 'notes'}" (click)="setActiveSection('notes'); $event.preventDefault()">
        Mes Notes
      </a>
      
      <a *ngIf="isTeacher()" class="block py-3 px-6 text-blue-700 no-underline font-medium transition-all border-l-4 border-transparent hover:bg-slate-100 hover:text-blue-500" [ngClass]="{'bg-blue-100 text-blue-800 border-l-blue-600 font-bold shadow-sm': activeSection === 'saisie'}" (click)="setActiveSection('saisie'); $event.preventDefault()">
        Saisir Notes
      </a>
      
      <a *ngIf="isTeacher()" class="block py-3 px-6 text-blue-700 no-underline font-medium transition-all border-l-4 border-transparent hover:bg-slate-100 hover:text-blue-500" [ngClass]="{'bg-blue-100 text-blue-800 border-l-blue-600 font-bold shadow-sm': activeSection === 'mes-classes'}" (click)="setActiveSection('mes-classes'); $event.preventDefault()">
        üìö Mes Classes
      </a>
      
      <a *ngIf="isAdmin()" class="block py-3 px-6 text-blue-700 no-underline font-medium transition-all border-l-4 border-transparent hover:bg-slate-100 hover:text-blue-500" [ngClass]="{'bg-blue-100 text-blue-800 border-l-blue-600 font-bold shadow-sm': activeSection === 'utilisateurs'}" (click)="setActiveSection('utilisateurs'); $event.preventDefault()">
        Gestion d'utilisateurs
      </a>
      
      <a *ngIf="isAdmin()" class="block py-3 px-6 text-blue-700 no-underline font-medium transition-all border-l-4 border-transparent hover:bg-slate-100 hover:text-blue-500" [ngClass]="{'bg-blue-100 text-blue-800 border-l-blue-600 font-bold shadow-sm': activeSection === 'matieres'}" (click)="setActiveSection('matieres'); $event.preventDefault()">
        Mati√®res
      </a>
      
      <a *ngIf="isAdmin()" class="block py-3 px-6 text-blue-700 no-underline font-medium transition-all border-l-4 border-transparent hover:bg-slate-100 hover:text-blue-500" [ngClass]="{'bg-blue-100 text-blue-800 border-l-blue-600 font-bold shadow-sm': activeSection === 'classes'}" (click)="setActiveSection('classes'); $event.preventDefault()">
        Classes
      </a>
      
      <a class="block py-3 px-6 text-blue-700 no-underline font-medium transition-all border-l-4 border-transparent hover:bg-slate-100 hover:text-blue-500" [ngClass]="{'bg-blue-100 text-blue-800 border-l-blue-600 font-bold shadow-sm': activeSection === 'messagerie'}" (click)="setActiveSection('messagerie'); $event.preventDefault()">
        üí¨ Messagerie
      </a>
    </nav>

    <!-- Bouton D√©connexion en bas -->
    <div class="p-5 border-t border-indigo-100">
      <button (click)="logout()" class="w-full p-3 bg-transparent text-red-600 border border-red-600 rounded-lg font-medium cursor-pointer transition-all hover:bg-red-600 hover:text-white">
        D√©connexion
      </button>
    </div>
  </aside>

  <!-- Zone de contenu -->
  <main class="flex-1 flex flex-col overflow-hidden">
    <!-- Header du contenu -->
    <header class="bg-white py-5 px-8 border-b border-indigo-100 flex justify-between items-center shadow-sm shadow-blue-100">
      <div class="flex items-center gap-6">
        <h1 class="text-3xl font-bold text-blue-700 m-0">{{ getSectionTitle() }}</h1>
        <div class="relative">
          <div class="relative flex items-center">
            <input type="text" 
                   [(ngModel)]="searchQuery" 
                   (input)="onSearch($event)"
                   placeholder="Rechercher..."
                   class="w-75 py-2 px-3 pr-10 border-2 border-indigo-100 rounded-full text-sm bg-slate-50 transition-all focus:outline-none focus:border-blue-500 focus:bg-white focus:shadow-lg focus:shadow-blue-100">
            <button class="absolute right-2 bg-none border-none text-base cursor-pointer p-1 rounded-full transition-colors hover:bg-indigo-100">
              üîç
            </button>
          </div>
          <div *ngIf="searchResults.length > 0 && searchQuery" class="absolute top-full left-0 right-0 bg-white border border-indigo-100 rounded-xl shadow-xl z-50 max-h-75 overflow-y-auto mt-1">
            <div *ngFor="let result of searchResults" 
                 class="flex items-center p-3 cursor-pointer transition-colors border-b border-slate-100 hover:bg-slate-50 last:border-b-0"
                 (click)="selectSearchResult(result)">
              <div class="text-xl mr-3 w-6 text-center">{{ getResultIcon(result.type) }}</div>
              <div class="flex-1">
                <div class="font-medium text-blue-700 text-sm">{{ result.title }}</div>
                <div class="text-xs text-slate-500 mt-0.5">{{ result.subtitle }}</div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="flex items-center gap-5">
        <div class="flex items-center gap-4">
          <app-notifications></app-notifications>
          <app-chat></app-chat>
        </div>
        
        <div class="flex items-center gap-3 cursor-pointer" *ngIf="currentUser">
          <div class="text-right">
            <span class="block font-semibold text-blue-700 text-sm">{{ currentUser.firstname }} {{ currentUser.lastname }}</span>
            <span class="block text-xs text-slate-500">{{ getRoleDisplayName(currentUser.role) }}</span>
          </div>
          <div class="w-10 h-10 rounded-full overflow-hidden border-2 border-indigo-100 transition-all hover:border-blue-500 hover:scale-105" (click)="openProfileModal()">
            <img [src]="getAvatarUrl(currentUser.firstname, currentUser.lastname)" 
                 [alt]="currentUser.firstname + ' ' + currentUser.lastname"
                 class="w-full h-full object-cover">
          </div>
        </div>
      </div>
    </header>

    <!-- Corps du contenu -->
    <div class="flex-1 p-8 overflow-y-auto bg-slate-50">
      <!-- Contenu selon la section active -->
      <div [ngSwitch]="activeSection">
        <!-- Dashboard -->
        <div *ngSwitchCase="'dashboard'">
          <app-student-dashboard *ngIf="isStudent()"></app-student-dashboard>
          <app-teacher-dashboard *ngIf="isTeacher()"></app-teacher-dashboard>
          <app-admin-dashboard *ngIf="isAdmin()"></app-admin-dashboard>
        </div>

        <!-- Notes pour √©tudiant -->
        <div *ngSwitchCase="'notes'">
          <div class="card">
            <h3>Mes Notes D√©taill√©es</h3>
            <app-student-dashboard></app-student-dashboard>
          </div>
        </div>

        <!-- Saisie pour enseignant -->
        <div *ngSwitchCase="'saisie'">
          <div class="card">
            <h3>Saisie des Notes</h3>
            <app-teacher-dashboard></app-teacher-dashboard>
          </div>
        </div>

        <!-- Utilisateurs pour admin -->
        <div *ngSwitchCase="'utilisateurs'">
          <app-admin-users></app-admin-users>
        </div>

        <!-- Mati√®res pour admin -->
        <div *ngSwitchCase="'matieres'">
          <app-admin-subjects></app-admin-subjects>
        </div>

        <!-- Classes pour admin -->
        <div *ngSwitchCase="'classes'">
          <div class="card">
            <div class="flex justify-between items-center mb-6">
              <h3 class="text-lg font-semibold">üè´ Gestion des Classes</h3>
              <button (click)="openClassModal()" class="btn-primary">
                ‚ûï Nouvelle Classe
              </button>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
              <div *ngFor="let class of classes" class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow">
                <div class="flex justify-between items-start mb-2">
                  <h4 class="font-semibold text-gray-900">{{ class.name }}</h4>
                  <span class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded">{{ class.academicYear }}</span>
                </div>
                <div class="flex justify-between items-center mt-4">
                  <span class="text-sm text-gray-500">Ann√©e: {{ class.academicYear }}</span>
                  <div class="flex space-x-2">
                    <button (click)="editClass(class)" class="text-blue-600 hover:text-blue-900 text-sm">
                      ‚úèÔ∏è Modifier
                    </button>
                    <button (click)="deleteClass(class)" class="text-red-600 hover:text-red-900 text-sm">
                      üóëÔ∏è Supprimer
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Messagerie -->
        <div *ngSwitchCase="'messagerie'">
          <app-messaging></app-messaging>
        </div>

        <!-- Mes Classes pour enseignant -->
        <div *ngSwitchCase="'mes-classes'">
          <div class="card">
            <h3>Mes Classes Assign√©es</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-4">
              <div *ngFor="let teacherClass of teacherClasses" class="border rounded-lg p-4 hover:shadow-md transition-shadow cursor-pointer" (click)="selectClass(teacherClass)">
                <h4 class="font-semibold text-blue-700">{{ teacherClass.className }}</h4>
                <p class="text-sm text-gray-600">{{ teacherClass.studentCount || 0 }} √©tudiants</p>
                <p class="text-xs text-gray-500">Ann√©e {{ teacherClass.academicYear }}</p>
                <button class="mt-2 text-sm bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600">
                  üìù G√©rer les notes
                </button>
              </div>
              <div *ngIf="teacherClasses.length === 0" class="col-span-full text-center text-gray-500 py-8">
                Aucune classe assign√©e
              </div>
            </div>
          </div>
        </div>

        <!-- Gestion des notes par classe -->
        <div *ngSwitchCase="'class-grades'">
          <div class="card">
            <div class="flex justify-between items-center mb-6">
              <div>
                <h3>Notes - Classe {{ selectedClassName }}</h3>
                <button (click)="setActiveSection('mes-classes')" class="text-blue-600 hover:text-blue-800 text-sm">
                  ‚Üê Retour aux classes
                </button>
              </div>
            </div>
            
            <div class="mb-4">
              <label class="block text-sm font-medium mb-2">Semestre :</label>
              <select [(ngModel)]="selectedSemester" class="input-field w-48">
                <option value="S1">Semestre 1</option>
                <option value="S2">Semestre 2</option>
              </select>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
              <div *ngFor="let student of classStudents" class="border rounded-lg p-4 hover:shadow-md transition-shadow">
                <div class="flex justify-between items-start mb-3">
                  <div>
                    <h4 class="font-semibold">{{ student.firstname }} {{ student.lastname }}</h4>
                    <p class="text-sm text-gray-600">ID: {{ student.studentId }}</p>
                  </div>
                  <button (click)="openGradeModal(student)" class="bg-green-500 text-white px-3 py-1 rounded text-sm hover:bg-green-600">
                    ‚ûï Note
                  </button>
                </div>
                
                <div class="space-y-2">
                  <div *ngFor="let grade of getStudentGrades(student.id)" class="flex justify-between items-center text-sm">
                    <span>{{ grade.subjectName }}</span>
                    <span class="font-semibold" [class]="getGradeColor(grade.value)">{{ grade.value }}/20</span>
                  </div>
                  <div *ngIf="getStudentGrades(student.id).length === 0" class="text-gray-500 text-sm">
                    Aucune note
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer class="bg-white py-4 px-8 border-t border-indigo-100 text-center">
      <p class="m-0 text-slate-500 text-sm">&copy; 2024 Kfokam 48 - Tous droits r√©serv√©s</p>
    </footer>
  </main>

  <!-- Modal de profil -->
  <app-profile-modal 
    [isOpen]="showProfileModal"
    [user]="currentUser"
    (close)="closeProfileModal()"
    (save)="saveProfile($event)">
  </app-profile-modal>
  
  <!-- Modal cr√©ation classe -->
  <div *ngIf="showClassModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
    <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
      <h3 class="text-lg font-medium text-gray-900 mb-4">‚ûï Nouvelle Classe</h3>
      <form [formGroup]="classForm" (ngSubmit)="onSubmitClass()">
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Nom de la classe</label>
            <input type="text" formControlName="name" class="input-field" placeholder="Ex: 3A">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Ann√©e acad√©mique</label>
            <input type="text" formControlName="academicYear" class="input-field">
          </div>
        </div>
        <div class="flex justify-end space-x-3 mt-6">
          <button type="button" (click)="closeClassModal()" class="btn-secondary">Annuler</button>
          <button type="submit" [disabled]="classForm.invalid" class="btn-primary">Cr√©er</button>
        </div>
      </form>
    </div>
  </div>
  
  <!-- Modal saisie note -->
  <div *ngIf="showGradeModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
    <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
      <h3 class="text-lg font-medium text-gray-900 mb-4">üìù Note pour {{ selectedStudent?.firstname }} {{ selectedStudent?.lastname }}</h3>
      <form [formGroup]="gradeForm" (ngSubmit)="onSubmitGrade()">
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Mati√®re</label>
            <input type="text" formControlName="subjectName" class="input-field" placeholder="Ex: Math√©matiques">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Note (/20)</label>
            <input type="number" formControlName="value" class="input-field" min="0" max="20" step="0.5">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Coefficient</label>
            <input type="number" formControlName="coefficient" class="input-field" min="0.5" max="5" step="0.5">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Commentaire</label>
            <textarea formControlName="comment" class="input-field" rows="3" placeholder="Commentaire optionnel..."></textarea>
          </div>
        </div>
        <div class="flex justify-end space-x-3 mt-6">
          <button type="button" (click)="closeGradeModal()" class="btn-secondary">Annuler</button>
          <button type="submit" [disabled]="gradeForm.invalid" class="btn-primary">Ajouter Note</button>
        </div>
      </form>
    </div>
  </div>
  
  <!-- Composant Toast pour les notifications -->
  <app-toast></app-toast>
</div>